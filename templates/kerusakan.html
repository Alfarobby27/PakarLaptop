{% extends "base.html" %} {% block content %}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- ================= HEADER ================= -->
  <div class="mb-10">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h3 class="text-3xl font-bold text-white flex items-center gap-3">
          <i class="bi bi-exclamation-triangle-fill text-amber-400"></i>
          Data Kerusakan Laptop
        </h3>
        <p class="text-slate-400 mt-1">
          Daftar jenis kerusakan yang dapat terdeteksi oleh sistem
        </p>
      </div>
      <div class="text-right">
        <div class="text-3xl font-bold text-amber-400">{{ faults|length }}</div>
        <div class="text-xs uppercase tracking-wider text-slate-400">
          Total Kerusakan
        </div>
      </div>
    </div>
  </div>

  <!-- ================= FILTER ================= -->
  <div class="bg-slate-900/60 rounded-2xl border border-slate-700/50 p-6 mb-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Search -->
      <div class="md:col-span-2">
        <label class="text-sm text-slate-300 mb-2 block">
          <i class="bi bi-search"></i> Pencarian
        </label>
        <div class="relative">
          <input
            id="searchInput"
            type="text"
            placeholder="Cari berdasarkan kode atau nama kerusakan..."
            class="w-full bg-slate-800 border border-slate-600 rounded-lg py-3 pl-11 pr-10 text-sm text-slate-200 focus:ring-2 focus:ring-amber-500"
          />
          <i
            class="bi bi-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
          ></i>
          <button
            id="clearSearch"
            class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-amber-400"
          >
            <i class="bi bi-x-circle-fill"></i>
          </button>
        </div>
      </div>

      <!-- View Switch -->
      <div>
        <label class="text-sm text-slate-300 mb-2 block">
          <i class="bi bi-layout-wtf"></i> Tampilan
        </label>

        <div class="flex gap-2">
          <!-- TABLE -->
          <button
            id="tableViewBtn"
            class="flex-1 py-3 rounded-lg text-sm font-semibold border bg-amber-500/20 border-amber-500/40 text-amber-400 hover:bg-amber-500/30 transition"
          >
            <i class="bi bi-table"></i> Tabel
          </button>

          <!-- CARD -->
          <button
            id="cardViewBtn"
            class="flex-1 py-3 rounded-lg text-sm font-semibold border bg-slate-800 border-slate-600 text-slate-300 hover:bg-slate-700 transition"
          >
            <i class="bi bi-grid-3x3-gap"></i> Kartu
          </button>
        </div>
      </div>
    </div>

    <div class="flex justify-between items-center mt-4 text-sm">
      <span class="text-slate-400">
        Menampilkan
        <span id="visibleCount" class="text-amber-400 font-semibold">
          {{ faults|length }}
        </span>
        data
      </span>
      <button
        id="resetFilters"
        class="hidden text-amber-400 hover:text-amber-300"
      >
        <i class="bi bi-arrow-counterclockwise"></i> Reset
      </button>
    </div>
  </div>

  <!-- ================= TABLE VIEW ================= -->
  <div id="tableView">
    <div
      class="bg-slate-900 rounded-2xl border border-slate-700 overflow-hidden"
    >
      <table class="w-full text-sm">
        <thead class="bg-slate-800 text-slate-300">
          <tr>
            <th class="px-6 py-4 w-24 text-left">Kode</th>
            <th class="px-6 py-4 text-left">Nama Kerusakan</th>
            <th class="px-6 py-4 text-left">Solusi</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-700">
          {% for code, fault in faults.items() %}
          <tr
            class="fault-row hover:bg-slate-800 transition"
            data-code="{{ code }}"
            data-name="{{ fault.name }}"
          >
            <td class="px-6 py-4">
              <span
                class="px-3 py-1 rounded-full bg-amber-500/10 text-amber-400 border border-amber-500/20 text-xs font-semibold"
              >
                {{ code }}
              </span>
            </td>
            <td class="px-6 py-4 text-slate-200 font-medium">
              {{ fault.name }}
            </td>
            <td class="px-6 py-4 text-slate-400">{{ fault.solution }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ================= CARD VIEW ================= -->
  <div
    id="cardView"
    class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
  >
    {% for code, fault in faults.items() %}
    <div
      class="fault-card bg-slate-900 border border-slate-700 rounded-2xl p-6 hover:border-amber-500/50 transition"
      data-code="{{ code }}"
      data-name="{{ fault.name }}"
    >
      <span
        class="text-xs px-3 py-1 rounded-full bg-amber-500/10 text-amber-400 border border-amber-500/20"
      >
        {{ code }}
      </span>

      <h4 class="text-lg font-semibold text-white mt-3">{{ fault.name }}</h4>

      <p class="text-sm text-slate-400 mt-2">
        <strong>Solusi:</strong> {{ fault.solution }}
      </p>
    </div>
    {% endfor %}
  </div>

  <!-- ================= EMPTY ================= -->
  <div id="noResults" class="hidden text-center py-16">
    <i class="bi bi-search text-5xl text-slate-600 mb-4"></i>
    <p class="text-slate-400 text-lg">Data tidak ditemukan</p>
    <p class="text-slate-500 text-sm">Gunakan kata kunci lain</p>
  </div>

  <!-- ================= BACK ================= -->
  <div class="mt-10">
    <a
      href="/"
      class="inline-flex items-center gap-2 px-8 py-3 bg-slate-800 hover:bg-slate-700 rounded-lg border border-slate-600 text-slate-200 transition"
    >
      <i class="bi bi-arrow-left"></i> Kembali
    </a>
  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
  const searchInput = document.getElementById("searchInput");
  const clearSearch = document.getElementById("clearSearch");
  const resetBtn = document.getElementById("resetFilters");
  const tableBtn = document.getElementById("tableViewBtn");
  const cardBtn = document.getElementById("cardViewBtn");
  const tableView = document.getElementById("tableView");
  const cardView = document.getElementById("cardView");
  const rows = document.querySelectorAll(".fault-row");
  const cards = document.querySelectorAll(".fault-card");
  const visibleCount = document.getElementById("visibleCount");
  const noResults = document.getElementById("noResults");

  let currentView = "table";

  function setActiveButton(active, inactive) {
    active.className =
      "flex-1 py-3 rounded-lg text-sm font-semibold border bg-amber-500/20 border-amber-500/40 text-amber-400 hover:bg-amber-500/30 transition";
    inactive.className =
      "flex-1 py-3 rounded-lg text-sm font-semibold border bg-slate-800 border-slate-600 text-slate-300 hover:bg-slate-700 transition";
  }

  function switchView(view) {
    currentView = view;

    tableView.classList.toggle("hidden", view !== "table");
    cardView.classList.toggle("hidden", view !== "card");

    if (view === "table") {
      setActiveButton(tableBtn, cardBtn);
    } else {
      setActiveButton(cardBtn, tableBtn);
    }

    filter();
  }

  function filter() {
    const term = searchInput.value.toLowerCase().trim();
    let count = 0;
    const items = currentView === "table" ? rows : cards;

    items.forEach((el) => {
      const match =
        el.dataset.code.toLowerCase().includes(term) ||
        el.dataset.name.toLowerCase().includes(term);

      el.style.display = match ? "" : "none";
      if (match) count++;
    });

    visibleCount.textContent = count;
    noResults.classList.toggle("hidden", count !== 0);
    clearSearch.classList.toggle("hidden", !term);
    resetBtn.classList.toggle("hidden", !term);
  }

  searchInput.addEventListener("input", filter);
  clearSearch.addEventListener("click", () => {
    searchInput.value = "";
    filter();
  });
  resetBtn.addEventListener("click", () => {
    searchInput.value = "";
    filter();
  });

  tableBtn.addEventListener("click", () => switchView("table"));
  cardBtn.addEventListener("click", () => switchView("card"));

  filter();
</script>

{% endblock %}
